```{r}
# ----------------------------------------
# Deskriptive und explorative Datenanalyse
# Autor: Janka Schultze
# Datum: 2025-07-07
# Beschreibung: 
# Sammlung von Beispielanalysen mit bekannten Datensätzen (mtcars, warpbreaks, airquality, CO2, mpg).
# Enthält deskriptive Statistik, Häufigkeiten, Lagemaße, Streuungsmaße, Kreuztabellen, 
# Datenvisualisierungen mit ggplot2 sowie gruppierte Zusammenfassungen.
# Ziel: Einführung in grundlegende Methoden der Datenexploration und -beschreibung.
# ----------------------------------------
library(tidyverse)

# --- mtcars: Zylinder und Verbrauch analysieren ---

# Datensatz anschauen
mtcars

# Häufigkeitstabelle der Zylinderanzahl (Base R)
zylinder_tabelle <- table(mtcars$cyl)
print(zylinder_tabelle)

# Häufigkeitstabelle mit dplyr
mtcars %>% count(cyl)

# Relative Häufigkeit (Base R)
prop.table(zylinder_tabelle) * 100

# Relative Häufigkeit mit dplyr
mtcars %>%
  count(cyl) %>%
  mutate(anteil = n / sum(n))

# Lagemaße des Verbrauchs (mpg)
mean(mtcars$mpg)
median(mtcars$mpg)

# Modus berechnen (häufigster Wert)
modus_tabelle <- table(mtcars$mpg)
names(modus_tabelle)[which.max(modus_tabelle)]

# Streuungsmaße
var(mtcars$mpg)      # Varianz
sd(mtcars$mpg)       # Standardabweichung
range(mtcars$mpg)    # Spannweite (min, max)
diff(range(mtcars$mpg)) # Spannweite als Differenz

# Quantile und Interquartilsabstand
quantile(mtcars$mpg)
IQR(mtcars$mpg)

# Kreuztabelle von Zylindern und Getriebetyp
kreuztabelle <- table(mtcars$cyl, mtcars$am)
print(kreuztabelle)

# Kreuztabelle mit dplyr
mtcars %>% count(cyl, am)


# --- warpbreaks: Fadenbruchstatistiken und Gruppenvergleiche ---

# Datensatz anschauen und Dokumentation lesen
warpbreaks
?warpbreaks
head(warpbreaks)
str(warpbreaks)

# Häufigkeitstabelle der Wolltypen
wool_tabelle <- table(warpbreaks$wool)
print(wool_tabelle)

# dplyr-Alternative
warpbreaks %>% count(wool)

# Kreuztabelle Wolle und Spannung
wool_tension_tbl <- table(warpbreaks$wool, warpbreaks$tension)
print(wool_tension_tbl)

warpbreaks %>% count(wool, tension)

# Zusammenfassung der Daten
summary(warpbreaks)

# Lagemaße der Fadenbrüche
mean(warpbreaks$breaks)
median(warpbreaks$breaks)
sd(warpbreaks$breaks)
var(warpbreaks$breaks)
range(warpbreaks$breaks)

# Gruppierte Lagemaße nach Wolltyp
warpbreaks %>%
  group_by(wool) %>%
  summarise(
    mean_brk = mean(breaks),
    median_brk = median(breaks),
    std_brk = sd(breaks)
  )

# Gruppierte Lagemaße nach Wolltyp und Spannung
kombi <- warpbreaks %>%
  group_by(wool, tension) %>%
  summarise(
    mean_break = mean(breaks),
    std_break = sd(breaks)
  )
print(kombi)

# Alternative mit aggregate (Basis R)
aggregate(breaks ~ wool + tension, data = warpbreaks, FUN = mean)
aggregate(breaks ~ wool + tension, data = warpbreaks, FUN = sd)

# Hinweis: Kombination Wolle A und Spannung H hat im Durchschnitt die wenigsten Fadenbrüche

# Boxplots der Fadenbrüche nach Wolltyp und Spannung 

boxplot(breaks ~ wool * tension, data = warpbreaks,
        col = c('lightgreen', 'lightblue'),
        main = 'Boxplot: Fadenbrüche nach Wolltyp und Spannung',
        xlab = 'Kombination Wolltyp und Spannung',
        ylab = 'Anzahl der Fadenbrüche')

# ggplot2-Version
ggplot(warpbreaks, aes(x = interaction(wool, tension), y = breaks)) +
  geom_boxplot(fill = 'lightgreen') +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(
    title = 'Boxplot: Fadenbrüche nach Wolltyp und Spannung',
    x = 'Kombination Wolltyp und Spannung',
    y = 'Anzahl der Fadenbrüche'
  )


# --- airquality: Temperatur, Ozon und Windverteilung ---

# Datensatz untersuchen
airquality
str(airquality)

# Histogramm der Tagestemperatur
ggplot(airquality, aes(x = Temp)) +
  geom_histogram(binwidth = 2, color = 'black', fill = 'skyblue') +
  labs(
    title = 'Verteilung der Tagestemperatur in New York',
    x = 'Temperatur (Fahrenheit)',
    y = 'Frequenz'
  ) +
  theme_minimal()

# Scatterplot Temperatur vs. Ozon mit Regressionslinie
ggplot(airquality, aes(x = Temp, y = Ozone)) +
  geom_point() +
  geom_smooth(method = 'lm') + # lineare Regression
  labs(title = 'Beziehung zwischen Temperatur und Ozonkonzentration')

# Boxplot der Windgeschwindigkeit pro Monat
ggplot(airquality, aes(x = as.factor(Month), y = Wind, fill = as.factor(Month))) +
  geom_boxplot() +
  labs(
    title = 'Windgeschwindigkeit pro Monat',
    x = 'Monat',
    y = 'Windgeschwindigkeit'
  ) +
  guides(fill = 'none') # Legende entfernen

# Daten bereinigen (NA in Ozone entfernen)
airquality_clean <- airquality %>% filter(!is.na(Ozone))

# Scatterplot mit Facetten nach Monat
ggplot(airquality_clean, aes(x = Temp, y = Ozone)) +
  geom_point() +
  geom_smooth(method = 'lm') +
  facet_wrap(~ Month) +
  labs(title = 'Beziehung zwischen Temperatur und Ozonkonzentration pro Monat')


# ---  CO2: CO2-Aufnahme nach Pflanzenart und Behandlung ---
head(CO2)

# Durchschnittliche CO2-Aufnahme nach Pflanzentyp
mean_uptake_type <- CO2 %>%
  group_by(Type) %>%
  summarise(Mean_Uptake = mean(uptake))

# Balkendiagramm der durchschnittlichen CO2-Aufnahme
ggplot(mean_uptake_type, aes(x = Type, y = Mean_Uptake, fill = Type)) +
  geom_col() +  # Alternative: geom_bar(stat = "identity")
  labs(
    title = 'Durchschnittliche CO2-Aufnahme nach Pflanzentyp',
    x = 'Pflanzentyp',
    y = 'Durchschnittliche CO2-Aufnahme'
  )

# Boxplot CO2-Aufnahme nach Behandlung und Pflanzentyp
ggplot(CO2, aes(x = Treatment, y = uptake, fill = Type)) +
  geom_boxplot()


# --- mpg: Motorleistung und Verbrauch nach Fahrzeugtyp ---
?mpg
head(mpg)

# Scatterplot Motorhubraum vs. Autobahnverbrauch, farblich nach Fahrzeugklasse
ggplot(mpg, aes(x = displ, y = hwy, colour = class)) +
  geom_point() +
  labs(
    title = 'Motorhubraum vs. Autobahnverbrauch',
    subtitle = 'Farblich nach Fahrzeugklasse',
    x = 'Motorhubraum in Litern',
    y = 'Autobahnverbrauch in Meilen pro Gallone'
  )

# Balkendiagramm der Antriebsarten
ggplot(mpg, aes(x = drv, fill = drv)) +
  geom_bar()

# Scatterplot mit Facetten nach Antriebsart
ggplot(mpg, aes(x = displ, y = hwy, colour = class)) +
  geom_point() +
  facet_wrap(~ drv) +
  labs(
    title = 'Motorhubraum vs. Autobahnverbrauch',
    subtitle = 'Farblich nach Fahrzeugklasse',
    x = 'Motorhubraum in Litern',
    y = 'Autobahnverbrauch in Meilen pro Gallone'
  ) +
  theme_bw()


# --- starwars: Charakterübersicht und -merkmale ---

# Überblick über die Struktur des Starwars-Datensatzes
glimpse(starwars)

# Erste 6 Zeilen und Anzahl der Spalten anzeigen
head(starwars)  

# Alle Charaktere der Spezies "Droid" filtern
droiden <- starwars %>% 
  filter(species == 'Droid')

# Charaktere von Alderaan mit Körpergröße unter 180 cm auswählen
charaktere_alderaan <- starwars %>% 
  filter(homeworld == 'Alderaan', height < 180) %>% 
  select(name, height, homeworld)

print(charaktere_alderaan)  

# Die 6 leichtesten Charaktere nach Masse sortiert anzeigen
leichteste_charaktere <- starwars %>%
  filter(!is.na(mass)) %>%  
  arrange(mass) %>%         
  head(6)

print(leichteste_charaktere)  

# BMI berechnen und Top 10 Charaktere nach BMI ausgeben
bmi_charaktere <- starwars %>% 
  filter(!is.na(mass) & !is.na(height)) %>%  
  mutate(bmi = mass / (height / 100)^2) %>%  
  select(name, mass, height, bmi)

print(head(bmi_charaktere %>% arrange(desc(bmi)), 10))  

# Durchschnittliche Körpergröße und Anzahl der Charaktere nach Geschlecht
starwars_gruppiert <- starwars %>% 
  filter(!is.na(gender) & !is.na(height)) %>% 
  group_by(gender) %>% 
  summarise(
    Durchschnittsgröße = mean(height),
    Anzahl_Charaktere = n()
  )

print(starwars_gruppiert)

# Anzahl der Charaktere ohne Angabe zur Haarfarbe
anzahl_ohne_haarfarbe <- starwars %>% 
  filter(is.na(hair_color)) %>% 
  nrow()

print(anzahl_ohne_haarfarbe)  

# Balkendiagramm: Anzahl der Charaktere pro Spezies (nach Häufigkeit sortiert)
starwars %>% 
  filter(!is.na(species)) %>% 
  ggplot(aes(y = fct_infreq(species))) +  
  geom_bar() +
  labs(
    title = 'Anzahl der Charaktere pro Spezies',
    y = 'Spezies',
    x = 'Anzahl'
  )

# Scatterplot: Zusammenhang zwischen Körpergröße und Masse, farblich nach Geschlecht
ggplot(data = starwars, aes(x = height, y = mass, color = gender)) +
  geom_point(size = 3, alpha = 0.8) +
  labs(
    title = 'Zusammenhang zwischen Größe und Masse von Star Wars Charakteren',
    subtitle = 'Gefärbt nach Geschlecht',
    x = 'Größe in cm',
    y = 'Masse in kg',
    color = 'Geschlecht'
  ) +
  theme_minimal()


# --- chickwts: Analyse von Kükengewichten nach Futterart ---

# Überblick über den Datensatz
datasets::chickwts
?chickwts
str(chickwts)

# Erste und letzte Zeilen des Datensatzes ansehen
head(chickwts)
tail(chickwts)

# Zusammenfassung der Kükengewichte nach Futterart
info_futterart <- chickwts %>% 
  group_by(feed) %>% 
  summarise(
    Durchschnittsgewicht = mean(weight),
    Median_Gewicht = median(weight),
    Std_Gewicht = sd(weight),
    Minimalgewicht = min(weight),
    Maximalgewicht = max(weight),
    Anzahl_Küken = n()
  ) %>% 
  arrange(Durchschnittsgewicht)

print(info_futterart)

# Fehlende Werte prüfen und Häufigkeiten der Futterarten anzeigen
sum(is.na(chickwts))  # keine fehlenden Werte
table(chickwts$feed)

# Visualisierung: Boxplot der Kükengewichte nach Futterart
ggplot(data = chickwts, aes(x = feed, y = weight, fill = feed)) +
  geom_boxplot() +
  labs(
    title = 'Kükengewichte nach Futterart',
    x = 'Futterart',
    y = 'Gewicht in Gramm'
  ) +
  theme_minimal() +
  theme(legend.position = 'none')

# Visualisierung: Violinplot mit Punktwolke (Jitter) zur Verteilung der Gewichte
ggplot(chickwts, aes(x = feed, y = weight, fill = feed)) +
  geom_violin() +
  geom_jitter(width = 0.1, alpha = 0.5) +
  labs(
    title = 'Verteilung der Kükengewichte je Futterart',
    x = 'Futterart',
    y = 'Gewicht in Gramm'
  ) +
  theme_minimal() +
  theme(legend.position = 'none')

# Balkendiagramm: Durchschnittliches Kükengewicht je Futterart
ggplot(info_futterart, aes(x = reorder(feed, -Durchschnittsgewicht), y = Durchschnittsgewicht, fill = feed)) +
  geom_bar(stat = 'identity') +
  geom_text(aes(label = round(Durchschnittsgewicht, 1)), vjust = 1.5, color = "white", size = 4) +
  labs(
    title = 'Durchschnittliches Kükengewicht pro Futterart',
    x = 'Futterart',
    y = 'Durchschnittliches Gewicht (g)'
  ) +
  theme_minimal() +
  theme(legend.position = 'none')

# Referenzlevel der Futterart für das lineare Modell setzen
chickwts$feed <- relevel(chickwts$feed, ref = 'horsebean')
levels(chickwts$feed)  # 'horsebean' ist erste Kategorie

# Lineares Modell: Gewicht abhängig von Futterart
model <- lm(weight ~ feed, data = chickwts)
summary(model)


# --- Wetterdaten Finnland 2017: Datenbereinigung und Monatsstatistiken ---

# Datensatz einlesen
wetter_finnland <- read.csv('data/finnland-weather-2017.csv', header = TRUE)

# Überblick über den Datensatz
head(wetter_finnland)
str(wetter_finnland)
summary(wetter_finnland)

# Spaltennamen für bessere Lesbarkeit umbenennen
wetter_finnland_leserlich <- wetter_finnland %>% 
  rename(
    Jahr = Year,
    Monat = m,
    Tag = d,
    Zeit = Time,
    Zeitzone = Time.zone,
    `Niederschlag (mm)` = Precipitation.amount..mm.,
    `Schneehöhe (cm)` = Snow.depth..cm.,
    `Temperatur (°C)` = Air.temperature..degC. 
  )

# Datenbereinigung: Werte anpassen und NA setzen
wetter_finnland_bereinigt <- wetter_finnland_leserlich %>%
  mutate(
    `Niederschlag (mm)` = ifelse(`Niederschlag (mm)` == -1, 0, `Niederschlag (mm)`),
    `Schneehöhe (cm)` = ifelse(`Schneehöhe (cm)` %in% c(-1, ''), NA, `Schneehöhe (cm)`),
    `Schneehöhe (cm)` = as.numeric(`Schneehöhe (cm)`)
  )

# Monatliche Aggregation der Wetterdaten
wetter_finnland_Monate <- wetter_finnland_bereinigt %>% 
  group_by(Monat) %>% 
  summarise(
    Temperatur_Mittel = mean(`Temperatur (°C)`, na.rm = TRUE),
    Niederschlag_Gesamt = sum(`Niederschlag (mm)`, na.rm = TRUE),
    Schneehöhe_Mittel = mean(`Schneehöhe (cm)`, na.rm = TRUE),
    Tage_Schnee = sum(`Schneehöhe (cm)` > 0, na.rm = TRUE)
  )

print(wetter_finnland_Monate)

# Visualisierung: Durchschnittstemperatur pro Monat
ggplot(wetter_finnland_Monate, aes(x = Monat, y = Temperatur_Mittel)) +
  geom_line() +
  labs(
    title = 'Monatliche Durchschnittstemperatur in Finnland 2017',
    x = 'Monat',
    y = 'Temperatur (°C)'
  ) +
  theme_gray()

# Visualisierung: Gesamtniederschlag pro Monat
ggplot(wetter_finnland_Monate, aes(x = Monat, y = Niederschlag_Gesamt)) +
  geom_col() +
  labs(
    title = 'Gesamtniederschlag pro Monat in Finnland 2017',
    x = 'Monat',
    y = 'Niederschlag (mm)'
  ) +
  theme_gray()

# Visualisierung: Durchschnittliche Schneehöhe pro Monat
ggplot(wetter_finnland_Monate, aes(x = Monat, y = Schneehöhe_Mittel)) +
  geom_col() +
  labs(
    title = 'Durchschnittliche Schneehöhe pro Monat in Finnland 2017',
    x = 'Monat',
    y = 'Schneehöhe (cm)'
  ) +
  theme_gray()


# Ende des Analysekripts
cat('Fertig: komplettes Analyseskript geladen.\n')
```

